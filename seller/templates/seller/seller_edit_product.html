<h1>상품 수정 ({{ product.product_name }})</h1>

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <input type="hidden" name="product_id" value="{{ product.id }}">
  <div class="form-group">
    <label for="product_name">상품 이름:</label>
    <input type="text" class="form-control" id="product_name" name="product_name" value="{{ product.product_name }}">
  </div>
  <div class="form-group">
    <label for="price">가격:</label>
    <input type="number" class="form-control" id="price" name="price" value="{{ product.price }}">
  </div>
  <div class="form-group">
    <label for="description">상품 설명:</label>
    <textarea class="form-control" id="description" name="description">{{ product.description }}</textarea>
  </div>
  <div>
    <label for="is_visible" class="form-label">노출:</label>
    <select name="is_visible" class="form-control" id="is_visible">
        <option value="True" {% if product.is_visible %}selected{% endif %}>노출</option>
        <option value="False" {% if not product.is_visible %}selected{% endif %}>비노출</option>
    </select>
</div>  
  <div class="form-group">
    <label for="stock">재고:</label>
    <input type="number" class="form-control" id="stock" name="stock" value="{{ product.stock }}">
  </div>
  <div class="form-group">
    <label for="discount_rate">할인율 (예: 0.1 = 10%):</label>
    <input type="number" step="0.01" class="form-control" id="discount_rate" name="discount_rate" value="{{ product.discount_rate }}">
  </div>
  <div>
    <label for="is_option" class="form-label">옵션:</label>
    <select name="is_option" class="form-control" id="is_option">
        <option value="True" {% if product.is_option %}selected{% endif %}>있음</option>
        <option value="False" {% if not product.is_option %}selected{% endif %}>없음</option>
    </select>
</div>  
  <div class="form-group">
    <label for="images">상품 이미지 (여러 개 선택 가능):</label>
    <input type="file" class="form-control" id="images" name="images" multiple>
    <small class="text-muted">기존 이미지는 수정 페이지에서 변경할 수 없습니다. 새로운 이미지를 추가하려면 여기에 업로드하세요.</small>
  </div>

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  {% if existing_images %}
    <h2>기존 이미지</h2>
    <ul class="list-group">
      {% for image in existing_images %}
        <li class="list-group-item">
          <img src="{{ image.image_url }}" alt="{{ product.product_name }}" width="100">
          <input type="checkbox" name="delete_image_ids" value="{{ image.pk }}">
          <label for="delete_image_id_{{ image.pk }}">삭제</label>
        </li>
      {% endfor %}
    </ul>
  {% endif %}
  <input type="hidden" name="delete_image_ids" value="">  <!-- 숨겨진 입력 요소 -->
  <button type="submit" class="btn btn-primary">수정 완료</button>
</form>  

<script>
  $(document).ready(function() {
    $('input[name="delete_image_ids"]').prev('ul').find('input[name="delete_image_ids"]').change(function() {
      var deleteImageIds = [];
      $('input[name="delete_image_ids"]:checked').each(function() {
        deleteImageIds.push($(this).val());
      });
      $('input[name="delete_image_ids"]').val(deleteImageIds.join(','));
    });
  });
</script>
